### 多表形式

1对n，1对1，n对n

```sql
 CREATE TABLE tab_category(
    cid INT PRIMARY KEY AUTO_INCREMENT,
    cnmae VARCHAR(100) NOT NULL UNIQUE
 );
 CREATE TABLE tab_route(
    rid INT PRIMARY KEY AUTO_INCREMENT,
    rname VARCHAR(10) NOT NULL UNIQUE,
    price DOUBLE,
    cid INT,
    FOREIGN KEY (cid) REFERENCES tab_category(cid) -- 外键名称省略，自动分配
 );
 CREATE TABLE tab_user(
    uid INT PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(100) UNIQUE NOT NULL,
    `password` VARCHAR(30) NOT NULL,
    `name` VARCHAR(100),
    birthday DATE,
    sex CHAR(1) DEFAULT '男',
    telephone VARCHAR(11),
    email VARCHAR(100)
 );
 CREATE TABLE tab_favorite( -- 多对多用中间表
    rid INT,
    `date` DATETIME,
    uid INT,
    PRIMARY KEY(rid,uid),
    FOREIGN KEY(rid) REFERENCES tab_route(rid),
    FOREIGN KEY(uid) REFERENCES tab_user(uid)
 );
```

### 多表查询的分类

内连接查询：两表交集

```sql
-- 隐式内连接：使用where条件消除无用数据
SELECT t1.name, t1.gender, t2.name
FROM emp t1, dept t2 -- 起别名
WHERE t1.'dept_id' = t2.'id';
-- 显示内连接：
SELECT * FROM emp [INNER] JOIN dept ON emp.'dept_id' = dept.'id';
SELECT 字段列表 FROM 表1 INNNER JOIN 表2 ON 条件;
```

外连接查询：左(右)表所有数据+交集

```sql
左外连接
select * from tb1 left [outer] join tb2 on 条件
右外连接
select * from tb1 right [outer] join tb2 on 条件
```

子查询：嵌套查询

```sql
子查询的结果集是单行单列
select * from emp where emp.`salary` = (select max(salay) from emp);
select * from emp where emp.`salary` < (select avg(salary) from emp);
多行单列
select * from emp where dept_id in (select id from dept where `name`='财务部' or `name`='市场部');
多行多列,作为新表用
select * from dept t1, (select * from emp where emp.`join`_date` > '2011-11-11') t2
where t1.id = t2.dept_id;
```
